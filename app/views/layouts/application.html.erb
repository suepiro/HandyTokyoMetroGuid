<!DOCTYPE html>
<html>
	<head>
		<title><%= full_title(yield(:title)) %></title>
	  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
	  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
	<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
	<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
   <%= javascript_include_tag "jquery-1.11.1", "data-turbolinks-track" => true %>
	  <%= csrf_meta_tags %>
	  <%= render 'layouts/shim' %>
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    <script>
      // 現在地を取得する処理です。
      // 成功時にはコールバックsuccess、エラー時にはコールバックerrorが実行されます 。
      navigator.geolocation.getCurrentPosition(success, error);

      // 位置情報を取得できた場合のコールバックです。テキストボックスに緯度経度を格納します。
      function success(position) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;

        lon = 139.766926;
        lat = 35.681265;

        $.ajax({
          url: "/index",
          type: "POST",
          data: {lat:lat,lon:lon}
        });
        document.getElementById("position_msg").innerHTML = "デバイスの位置情報を取得しました";
      }
      // 位置情報取得失敗時のコールバックです。エラーメッセージを表示します。
      function error(error) {
        var error_msg = "";
        switch(error.code)
        {
          case error.PERMISSION_DENIED:
            error_msg = "位置情報の利用を有効にしてください";
            break;
          case error.POSITION_UNAVAILABLE:
            error_msg = "デバイスの位置が判定できませんでした";
            break;
          case error.TIMEOUT:
            error_msg = "位置情報の取得にタイムアウトしました";
            break;
        }
        document.getElementById("position_msg").innerHTML = error_msg;
      }
    </script>
	</head>
	<body>
		<%= render 'layouts/header' %>
		<div class="container">
			<% flash.each do |key, value| %>
				<%= content_tag(:div, value, class: "alert alert-#{key}") %>
			<% end %>
			<%= yield %> <!--ここに各.erbの内容が挿入される-->
      <%= render 'layouts/trainMap' %>
			<%= render 'layouts/footer' %>
			<%= debug(params) if Rails.env.development? %>
		</div>
	</body>
</html>
